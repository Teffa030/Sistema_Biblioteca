
{% load static %}

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tesoro de Papel</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body class="p-3 m-0 border-0 bd-example m-0 border-0">
  
<!--Barra de nabegacion -->
<nav class="navbar navbar-expand-lg bg-dark w-100" data-bs-theme="dark" fixed-bottom>
  <div class="container-fluid">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarTogglerDemo03" aria-controls="navbarTogglerDemo03" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <a class="navbar-brand" >
      <img src="{% static 'img/logo.png' %}" alt="Logo" width="50" height="40" class="d-inline-block align-text-top">
      <font style="vertical-align: inherit;"><font style="vertical-align: inherit;"></font></font></a>
    <div class="collapse navbar-collapse" id="navbarTogglerDemo03">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        <li class="nav-item">
          <a class="nav-link active" aria-current="page" >
          <font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inicio</font></font></a>
        </li>
      </ul>
    </div>
  </div>
</nav>

    <!-- carrusel -->
    <div id="carouselExampleAutoplaying" class="carousel slide" data-bs-ride="carousel">
        <div class="carousel-inner">
          <div class="carousel-item active">
            <img src="{% static 'img/encabezado.png' %}" style="height: 500px; object-fit: cover; width: 100%;" class="d-block w-80 img-fluid custom-img" alt="Encabezado de Tesoro de Papel">
          </div>
          <div class="carousel-item">
            <img src="{% static 'img/encabezado1.png' %}" style="height: 500px; object-fit: cover; width: 100%;" class="d-block w-80 img-fluid custom-img" alt="Encabezado de Tesoro de Papel">
          </div>
          <div class="carousel-item">
            <img src="{% static 'img/encabezado2.png' %}" style="height: 500px; object-fit: cover; width: 100%;" class="d-block w-80 img-fluid custom-img" alt="Encabezado de Tesoro de Papel">
          </div>
        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleAutoplaying" data-bs-slide="prev">
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Previous</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleAutoplaying" data-bs-slide="next">
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Next</span>
        </button>
      </div>
    <!-- Encabezado -->
    <header class="bg-light text-center py-5">
        <div class="container">
            <h1 class="display-4 fw-bold">Tesoro de Papel</h1>
            <p class="lead">Una biblioteca para registrar los libros que hemos leído, ya sean físicos o digitales.</p>
        </div>
    </header>

    <!-- Sección Nosotros -->
    <section class="py-5">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <h2 class="fw-bold mb-4">Acerca de Nosotros</h2>
                    <p class="mb-4">En <strong>Tesoro de Papel</strong>, celebramos el amor por la lectura. Nuestra plataforma te permite registrar y organizar los libros que has leído, ya sean físicos o digitales, 
                        para crear un registro personal y compartir tu pasión por la lectura con otros.</p>
                </div>
                <div class="col-md-6">
                    <img src="{% static 'img/img.png' %}" alt="Imagen temática de libros" class="img-fluid rounded">
                </div>
            </div>
        </div>
    </section>

    <!-- Sección Funciones -->
    <section class="bg-light py-5">
        <div class="container">
            <h2 class="text-center fw-bold mb-5">¿Qué ofrecemos?</h2>
            <div class="row">
                <div class="col-md-4 text-center">
                    <img src="{% static 'img/img1.png' %}" alt="Función 1" class="img-fluid mb-3">
                    <h5>Registro de libros</h5>
                    <p>Lleva un seguimiento de los libros que has leído, con detalles sobre su formato y autor.</p>
                </div>
                <div class="col-md-4 text-center">
                    <img src="{% static 'img/img2.png' %}" alt="Función 2" class="img-fluid mb-3">
                    <h5>Organización personalizada</h5>
                    <p>Crea tu biblioteca virtual con categorías, favoritos y más.</p>
                </div>
                <div class="col-md-4 text-center">
                    <img src="{% static 'img/img3.png' %}" alt="Función 3" class="img-fluid mb-3">
                    <h5>Compartir lecturas</h5>
                    <p>Comparte tus lecturas con amigos y descubre recomendaciones.</p>
                </div>
            </div>
        </div>
    </section>


    <div class="container mt-4">
      <h1>Tesoro de Papel</h1>
      
      <!-- Formulario de Creación de Evento -->
      <form id="formCrearLibro">
          <div class="form-group">
              <label for="codigolibro">Código Libro</label>
              <input type="text" class="form-control" id="codigolibro" required>
          </div>
          <div class="form-group">
              <label for="titulo">Titulo del libro</label>
              <input type="text" class="form-control" id="titulo" required>
          </div>
          <div class="form-group">
              <label for="autor">Autor del libro</label>
              <input type="text" class="form-control" id="autor" required>
          </div>
          <div class="form-group">
              <label for="aniopublicacion">Año de publicación</label>
              <input type="text" class="form-control" id="anioPublicacion" required>
          </div>
          <div class="form-group">
              <label for="tipo">Tipo de libro</label>
              <select class="form-control" id="tipo">
                  <option value="fisico">Libro Físico</option>
                  <option value="digital">Libro Digital</option>
              </select>
          </div>
          <div id="detallelibro"></div>
          <button type="submit" class="btn btn-success">Crear Libro</button>
      </form>

      <hr>

      <!-- Tablas para libro físico y libro digital -->
      <h2>Libro Físico</h2>
      <table class="table table-bordered" id="tablalibrofisico">
          <thead>
              <tr>
                  <th>Id</th>
                  <th>Titulo</th>
                  <th>Autor</th>
                  <th>Año Publicación</th>
                  <th>Número Página</th>
                  <th>Acciones</th>
              </tr>
          </thead>
          <tbody>
              <!-- Aquí se llenarán los libros físicos -->
          </tbody>
      </table>

      <h2>Libro Digital</h2>
      <table class="table table-bordered" id="tablalibrodigital">
          <thead>
              <tr>
                  <th>Id</th>
                  <th>Titulo</th>
                  <th>Autor</th>
                  <th>Año Publicación</th>
                  <th>Tamaño MB</th>
                  <th>Formato</th>
                  <th>Acciones</th>
              </tr>
          </thead>
          <tbody>
              <!-- Aquí se llenarán las conferencias -->
          </tbody>
      </table>

      <!-- Modal de Edición de libros -->
      <div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-labelledby="editarModalLabel" aria-hidden="true">
          <div class="modal-dialog" role="document">
              <div class="modal-content">
                  <div class="modal-header">
                      <h5 class="modal-title" id="editModalLabel">Editar Libro</h5>
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                          <span aria-hidden="true">&times;</span>
                      </button>
                  </div>
                  <div class="modal-body">
                      <form id="formEditLibro">
                          <input type="hidden" id="LibroId">
                          <div class="form-group">
                              <label for="tituloEdit">Titulo del libro</label>
                              <input type="text" class="form-control" id="tituloEdit" required>
                          </div>
                          <div class="form-group">
                              <label for="autorEdit">Autor del libro</label>
                              <input type="datetime-local" class="form-control" id="autorEdit" required>
                          </div>
                          <div class="form-group">
                              <label for="anioPublicacionEdit">Año Publicacion</label>
                              <input type="text" class="form-control" id="anioPublicacionEdit" required>
                          </div>
                          <div class="form-group">
                              <label for="tipoEdit">Tipo de libro</label>
                              <select class="form-control" id="tipoEdit">
                                  <option value="librofisico">fisico</option>
                                  <option value="librodigital">digital</option>
                              </select>
                          </div>
                          <div id="detalleLibroEdit"></div>
                          <button type="submit" class="btn btn-primary">Actualizar Evento</button>
                      </form>
                  </div>
              </div>
          </div>
      </div>

      <!-- Modal de Confirmación de Eliminación -->
      <div class="modal fade" id="confirmarEliminacion" tabindex="-1" role="dialog" aria-labelledby="confirmarEliminacionLabel" aria-hidden="true">
          <div class="modal-dialog" role="document">
              <div class="modal-content">
                  <div class="modal-header">
                      <h5 class="modal-title" id="confirmarEliminacionLabel">Confirmar Eliminación</h5>
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                          <span aria-hidden="true">&times;</span>
                      </button>
                  </div>
                  <div class="modal-body">
                      <p>¿Estás seguro de que deseas eliminar este libro?</p>
                  </div>
                  <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                      <button type="button" id="confirmarEliminarBtn" class="btn btn-danger">Eliminar</button>
                  </div>
              </div>
          </div>
      </div>

  </div>

  <script>
          // Mostrar campos específicos dependiendo del tipo de evento
          function mostrarCamposEspecificos(tipo, esEdicion = false) {
              const contenedor = esEdicion ? '#detalleLibroEdit' : '#detallelibro';
              $(contenedor).empty();
              
              if (tipo === 'fisico') {
                  $(contenedor).html(`
                      <div class="form-group">
                          <label for="numeroPagina${esEdicion ? 'Edit' : ''}">Número Página</label>
                          <input type="text" class="form-control" id="numeroPagina${esEdicion ? 'Edit' : ''}" required>
                      </div>   
                  `);
              } else if (tipo === 'digital') {
                  $(contenedor).html(`
                      <div class="form-group">
                          <label for="tamanomb${esEdicion ? 'Edit' : ''}">Tammaño MB</label>
                          <input type="text" class="form-control" id="tamanomb${esEdicion ? 'Edit' : ''}" required>
                      </div>
                      <div class="form-group">
                          <label for="formato${esEdicion ? 'Edit' : ''}">Formato</label>
                          <input type="text" class="form-control" id="formato${esEdicion ? 'Edit' : ''}" required>
                      </div>
                  `);
              }
          }
      
          // Cambiar los campos específicos según el tipo de evento
          $('#tipo').change(function() {
              mostrarCamposEspecificos($(this).val());
          });
      
          $('#tipoEdit').change(function() {
              mostrarCamposEspecificos($(this).val(), true);
          });
      
          // Crear libro                            ;)
          $('#formCrearLibro').submit(function(book) {
              book.preventDefault();
              const libro = {
                  codigolibro: $('#codigolibro').val(),
                  titulo: $('#titulo').val(),
                  autor: $('#autor').val(),
                  anioPublicacion: $('#anioPublicacion').val(),
                  tipo: $('#tipo').val(),
                  numeroPagina: $('#numeroPagina').val(),
                  tamanomb: $('#tamanomb').val(),
                  formato: $('#formato').val()
              };

              console.log(libro);
            
              const url = libro.tipo === 'fisico' ? '/api/Fisico/' : '/api/Digital/';
              console.log(url);
              
              // Enviar datos al backend
              $.ajax({
                  url: url,
                  method: 'POST',
                  data: JSON.stringify(libro),
                  contentType: 'application/json',
                  success: function(response) {
                    cargarLibro(); // Recargar eventos después de crear uno nuevo
                      // Limpiar el formulario
                      $('#formCrearLibro')[0].reset(); // Limpia todos los campos del formulario
                      $('#detallelibro').empty(); // Limpia los campos específicos (como numero Pagina, tamañomb, formato.)
                      $('#tipo').val('fisico'); // Restablecer tipo de evento a "concierto" por defecto
                  },
                  error: function() {
                      alert('Error al crear el libro');
                  }
              });
          });
      
          // Cargar libro
          function cargarLibro() {
              $.ajax({
                  url:`/api/Fisico/`,
                  method: 'GET',
                  success: function(Fisicos) {
                      $('#tablaFisico tbody').empty();
                      Fisicos.forEach(function(Fisico, index) {
                          $('#tablaFisico tbody').append(`
                              <tr data-id="${index}">
                                  <td>${Fisico.codigoLibro}</td>
                                  <td>${Fisico.titulo}</td>
                                  <td>${Fisico.autor}</td>
                                  <td>${Fisico.anioPublicacion}</td>
                                  <td>${Fisico.numeroPaginas}</td>
                                  <td>
                                      <button class="btn btn-warning btn-editar" data-id="${index}">Editar</button>
                                      <button class="btn btn-danger btn-eliminar" data-id="${index}">Eliminar</button>
                                  </td>
                              </tr>
                          `);
                      });
                  }
              });
      
              $.ajax({
                  url: `/api/Digital/`,
                  method: 'GET',
                  success: function(Digitales) {
                      $('#tablaDigital tbody').empty();
                      Digitales.forEach(function(Digital, index) {
                          $('#tablaDigital tbody').append(`
                              <tr data-id="${index}">
                                  <td>${Digital.codigoLibro}</td>
                                  <td>${Digital.titulo}</td>
                                  <td>${Digital.autor}</td>
                                  <td>${Digital.anioPublicacion}</td>
                                  <td>${Digital.tamanomb}</td>
                                  <td>${Digital.formato}</td>
                                  <td>
                                      <button class="btn btn-warning btn-editar" data-id="${index}">Editar</button>
                                      <button class="btn btn-danger btn-eliminar" data-id="${index}">Eliminar</button>
                                  </td>
                              </tr>
                          `);
                      });
                  }
              });
          }
      
          // Eliminar evento
          $(document).on('click', '.btn-eliminar', function() {
              const id = $(this).data('id');
              const tipo = $(this).closest('table').attr('id') === 'tablaFisico' ? 'Fisico' : 'Digital';
              $('#confirmarEliminacion').modal('show');
              $('#confirmarEliminarBtn').data('id', id).data('tipo', tipo);
          });
      
          // Confirmar eliminación
          $('#confirmarEliminarBtn').click(function() {
              const id = $(this).data('id');
              const tipo = $(this).data('tipo');
              const url = tipo === 'fisico' ? `/api/Fisico/${id}/` : `/api/Digital/${id}/`;
      
              $.ajax({
                  url: url,
                  method: 'DELETE',
                  success: function() {
                      cargarEventos(); // Recargar libro después de eliminar
                      $('#confirmarEliminacion').modal('hide');
                  },
                  error: function() {
                      alert('Error al eliminar el libro');
                  }
              });
          });
      
          // Editar evento
          $(document).on('click', '.btn-editar', function() {
              const id = $(this).data('id');
              const tipo = $(this).closest('table').attr('id') === 'tablaFisico' ? 'Fisico' : 'Digital';
      
              // Cargar el libro para editar
              $.ajax({
                  url: tipo === 'fisico' ? `/api/Fisico/${index}/` : `/api/Digital/${index}/`,
                  method: 'GET',
                  success: function(libro) {
                      libroIdActual = libro.codigoLibro;
                      $('#tituloEdit').val(libro.titulo);
                      $('#autorEdit').val(libro.autor);
                      $('#anioPublicacionEdit').val(libro.autor);
                      $('#tipoEdit').val(libro.tipo).change();
                      $('#numeroPaginasEdit').val(libro.numeroPaginas || '');
                      $('#tamanombEdit').val(libro.tamanomb || '');
                      $('#formatoEdit').val(libro.formato || '');
                      $('#editarModal').modal('show');
                  }
              });
        });

        // Actualizar libro

        $('#formEditarLibro').submit(function(book) {
            book.preventDefault();
            const libro = {
                codigoLibro: $('#codigoLibroEdit').val(),
                titulo: $('#tituloEdit').val(),
                autor: $('#autorEdit').val(),
                tipo: $('#tipoEdit').val(),
                numeroPaginas: $('#numeroPaginasEdit').val(),
                tamanomb: $('#tamanombEdit').val(),
                formato: $('#formatoEdit').val()
                
            };
    
            const url = libro.tipo === 'fisico' ? `/api/Fisico/${libroIdActual}/` : `/api/Digital/${libroIdActual}/`;
    
            $.ajax({
                url: url,
                method: 'PUT',
                data: JSON.stringify(evento),
                contentType: 'application/json',
                success: function(response) {
                    cargarLibro(); // Recargar libro después de actualizar uno
                    $('#editarModal').modal('hide');
                },
                error: function() {
                    alert('Error al actualizar el libro');
                }
            });
        });

        // Inicializar carga de libro
        cargarLibro();
    </script>


    <footer class="bg-dark text-white py-4 fixed-bottom">
      <div class="container text-center">
          <p class="mb-0">&copy; 2024 Tesoro de Papel. Todos los derechos reservados.</p>
      </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

</body>
</html>
